# デバイスとファイルシステム
### VFS?LFB?
#### VFS
  - Virtual File System
  - ファイルシステム抽象レイヤ
  - Systemcall(Open,read)を関数した場合にフォーマットに依存しないために存在するシステム
  - ファイルシステムの操作を実施
#### LFB
- Linux Filesystem Base
- これは階層の例
#### ファイルシステムの情報
- `/etc/fstab`ファイル例
- これは設定ファイル
  - 1. デバイスファイル/ラベル/UUID/
  - 2. マウントポイント
    - そのディスクをどこにマウントするか
  - 3. ファイルシステムの種類
    - ディスクのフォーマット`ext`等
  - 4. マウントオプション
    - roとかのオプション
  - 5. dumpの対象
    - 0を指定すると、dumpによるバックアップの対象外
  - 6. ブート時にfsckがチェックする順序
    - 0はチェックなし、1,2,3..の順でチェック
- moount -a とか fsck -A で参照される

#### UUIDを取得する
- 以下から取得できる
- `blkid`
- `ls -l /dev/disk/by-uuid/`
#### UUIDを設定する
- `tune2fs -U "uuidgen" /dev/sda1`


#### 【備忘】マウントオプション
- async/sync...アクセスを同期/非同期で実行
- atime...ファイルへのアクセスごとにinodeのアクセス時間を更新
- relatime...atimeが他のアクセス時刻より古ければ更新
- noatime..atimeを更新しない
- auto/noauto...mount -aでマウントするかどうか
- default...デフォルトの設定でマウント
- dev/nodev...ファイルシステムへのアクセスを禁止する
- group...デバイスファイルのグループ権を参照してマウントを許可する
- exe/noexe...バイナリ実行の可否
- suid/nosuid...SUID、SGIDビットを無効化する
- ro/rw...読み出し、書き出し専用でマウント
- uid=/gid=...内容を指定したUID、GIDにする(対応formatのみ)
- user...一般ユーザのマウントを許可。マウント者のみ取り外し
- users...一般ユーザのマウント許可。誰でも取り外し可能
- nouser...一般ユーザのマウント禁止
- owner...デバイスファイルの所有者によるマウントを許可

#### 備忘の備忘
- mtime....modify time。内容を更新したときに更新
- ctime...change time。権限などのメタデータを更新
- atime...accesstime。読み取った時刻で更新

#### 現在のmount状態を取得する
- mount...現在マウントしているファイルシステムの一覧
- /etc/mtab
  - 以下の順で表示
  - `デバイス名、マウントポイント、ファイルシステム、オプション、dump, fsck`
- /proc/mount でもほとんど同じ
- /etc/fstab...これはデフォルトのマウント情報を扱う
#### mountコマンド
- -a.../etc/fstabの設定の通りマウント。
- -f....etc/mtabの情報だけを書き換える。実際にはマウントしない
- -o {option} {dev}...マウントオプションの指定
  - -o remount...再マウント
  - -o noexec...バイナリの実行を許可しない
  - -o nosuid...SUID/SGIDを無効
  - -o loop...ループバックマウント(イメージファイルのマウント)
  - -o ro ....読み取り専用
- -n... /etc/mtabにマウント情報を書き込まない
- -r/-w... 読み取り専用/書き込み専用マウント
- -t {type} ファイルシステムを指定する
#### アンマウント
- umaunt -a.../etc/mtabで指定されているファイルシステムをアンマウント
- umaunt -t...指定した種類のファイルシステムのみアンマウント
### syncコマンド
- 書き込み指示をバッファメモリディスクに反映する
### スワップ
- 使用していないデバイスに対して実行する
- マウントしていないデバイスをスワップ領域とする
- スワップ用にデバイスが構成される
- `mkswap {dev}`
  - `-c`...作成と同時に不良ブロックを検出
  - `-L {lavel}`...ラベルを作成
### スワップをマウント/スワップをアンマウント
- マウント
  - `swapon`
    - -a.../etc/fstabのスワップを全て有効にする
    - -s...スワップ流域を表示
- スワップを表示
  - `cat /proc/swaps`
- スワップを解除
- `swapoff`
  - -s .../etc/fstabに記載のスワップをすべて無効化
- 厳密にはVFSに使用されるわけではないので、「マウント」という言葉ではない

## ファイルシステムの作成
### ext2/ext3/ext4の作成
### ext4
### XFSファイルシステムの作成
### Btrfsファイルシステムの作成
### mkfsコマンドによるファイルシステム作成
### CD/DVDの作成
### 暗号化ファイルシステムの作成
## ファイルシステムの保守
### ext2/ext3ファイルシステムの構造
### ファイルシステムのチェック
### ext2/ext3/ext4ファイルシステムの管理
### S.M.A.R.T.
### XFSファイルシステムの管理
### Btrfsファイルシステムの管理
### オートマウント
#### マップファイル

