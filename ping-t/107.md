# ここから102

### シェルとシェルスクリプト
- `printenv {環境変数名}`
  - その変数が出力される
### setコマンド
- `set -o` ... 設定されているオプションの一覧を確認
- `set -o {optionname}`...オプションを有効にする  
- `set +o {optionname}`...オプションを無効にする
- 主要なオプション
  - allexport
    - 作成・変更したシェル変数を自動的にエクスポートする
  - emacs
  - ignoreeof...ignore eofコマンドのこと、ctrl +dを無効化する
  - noclobber...no clobberの略。リダイレクトによる上書きを禁止
    - clobber...打撃を与える
  - noglob...メタキャラクタを使ったファイル名展開を無効化する
  - vi

### エイリアス
- `alias {key} = '{command}'`
  - &&や|などでコマンドの連結もできる
- `unalias {command}`
  - エイリアスを解除する
- `unalias -a`
  - 設定されているエイリアスを全て解除する
### エイリアスの無効化
- `\{command}`...エイリアスを無効にして実行する


### 関数
- `function {func_name}(){{process};}`
- 冒頭のfunctionはなくても良い。POSIX的には無い方がいい。
- func_name...関数名
- 一行で書くには、「;」は必須

### 関数の引数
- 関数内で`$1``$2`...などと代入して使用できる
- 呼び出しは`{func_name} {$1} {$2}...`という順序


### 関数定義の保存
- `export -f {func_name}`
  - -fは変数と名前被りしていなければ宣言可能
- この宣言は環境変数`BASH_FUNC_{funcname}`という環境変数に保存される

### 関数定義の削除
- unset {func_name}
  - シェル関数でも、環境変数化した関数でも削除できる
### declare 関数の確認(スペル注意)
- `declare`...シェル変数とシェル関数、エクスポートされた関数を表示
- `declare -f` ... 関数のみを表示
- `declare -F` .... 関数名のみを表示
- `declare -x` ... エクスポートされた関数のみを表示
- env,printenvに関しては、環境変数のみを表示する
  - exportした関数についても文字列としては見えている状態

### bashの設定ファイル
- ログインシェルとしてのbash
  - 1. `/etc/profile`
  - 2. `/etc/bash.bashrc`
  - 3. 以下をaから順に探す。実行されるのはいずれか一つ
    - a. `~/bash_profile`
    - b. `~/bash_login`
    - c. `~/.profile`
  - 4. `~/.bashrc`
- ログイン以外で使用するbash
  - `~/.bashrc`のみを見る

- 慣例的に処理.shの一連を/etc/profile.d/配下に配置したりする
### execコマンド
- 現在のシェルから起動する。子プロセスとしない。
  - PIDが起動元のシェルと同じになる

### shスクリプトにおける引数
- `./xx.sh {引数}`
- 参照方法。スクリプト中では以下のように扱う
  - `$0`...現在のシェルスクリプトのファイル名
  - `$1`,`$2`...1,2,3番目の引数
  - `$#`...引数の数
  - `$@`...全ての引数をスペース区切りで
  - `$*`...全ての引数を$IFSで指定した区切りで代入

### 環境変数 IFS
- Internal Field Separator
  - 区切り文字のこと
- 用途
  - 引数を与えるときにその区切り方法
  - a,b,cを引数に与えたい時は、`IFS=,`でなければならない
  - `$*`にも影響する
### 関数実行の戻り値
- `$?`
  - 直前の関数の実行結果を保存する
  - よく書き換えられるので扱いが難しい
  - 扱いとしてはシェルの内部変数。そのシェルが直前に実行した結果を保有している
### スクリプトのif
- `test`もしくは `[ ]`を使用する
- コマンドを実行した場合は、戻り値が使用される。0であれば真なので注意
- `if ... then ... else ... fi`で記述する

### test：ファイルの存在
- `test -f,d {file_name}`...ファイル/ディレクトリがあれば真。
- `test -r,w,x {file_name}`...ファイルが存在し、各種権限を所有していれば真
- `test -s {file_name}`...サイズが0より大きいファイルがあれば真
- `test -L {link_name}`...シンボリックリンクがあれば真
  - `[ -L {link_name} ]`と書いても同じ意味

### test:ファイルの特性
- `test -e {file_name}`...その名前が使用されているならば真
  - ファイル、ディレクトリ、シンボリックリンクどれでもいい
- `test {file1} -nt {file2}`...newer time
  - 修正時刻に関してファイル1の方が新しければ真
- `test {file1} -ot {file2}`...older time
  - 修正時刻に関してファイル1の方が古ければ真

### test:二つの値の比較
- `-eq`...値が等しい
- `-ge`...greater than or equal to 以上
- `-gt`...greater than より大きい
- `-le`...less than or equla to 以下
- `-lt`...less than より小さい
- `-ne`...not equal 等しく無い

### test:文字列
- `-n {key}`...文字列が0より大きければ真
- `-z {key}`...文字列が0ならば真
- `{key1}={key2}`...2つの文字列が等しければ真
- `{key1}!={key2}`...2つの文字列が異なれば真

### test: 論理結合
- `test {conf1} -a {conf2}`
  - 条件1と条件2が両方とも真ならば真
- `test {conf1} -o {conf2}`
  - 条件1もしくは条件2が真ならば真


### case
```
case {val} in
  ke1) {command} ;;
  ke2) {command} ;;
esac
```
で記述する
- esacはcaseの逆と覚えると良い

### for文
```
for {val} in {val1},{val2}...
do
    {process}
done
```
### seqコマンド
- 連続した値を出力する
- `seq 10 15`
  - 10,11,12,13,14,15を出力する
### while 文
```
while {cond}
do
    {prpcess}
done
```

### let 変数の宣言
- `let i=i+1`
  - 整数のみ演算可能
- `let "i = i + 1"`
  - スペースを挟む場合は、ダブルクォーテーションで囲ったりする。
### read 標準入力を読む
- `read {val_name}`
  - 変数名に代入される
### シェルの指定
- 1行目にどこで実行するか指定する
- `#!/bin/bash`

### そのほかスクリプトの注意点
- 実行に関しては、そのスクリプトのユーザIDで実行される
  - プロセスとしては、実行元の子プロセスとして実行
  - シェル変数は受け継がれない！
- SUID、SGIDを直接指定することはセキュリティ上危険
  - なので、SHID、SGIDは無視される
- 