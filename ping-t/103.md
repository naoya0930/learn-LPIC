# GNUとUnixコマンド
### シェル色々
- Bourne シェル(ah)
- Bourne Again Shellbash
- Cシェル(csh)
    - C言語のようなスクリプトを使用できる
- tcsh
    - C言語のようなスクリプトをりようできる
    - Linuxで使用可能
- Kornシェル(ksh)
- Zシェル(zsh)
    - kshにbashやzshの機能が入っている
- screen
    - シリアル通信を実施する際に利用する
### シェルの格納場所
- `/etc/shells`
### ログインシェル
- 起動時に起動するshell
- `/etc/passwd`に記載されている
- `user:x:1000:1000::/home/user:/bin/bash`
  - ユーザ名
  - パスワード、ベタ書きは通常しない
  - UID
  - GID
  - ユーザ情報
  - ホームディレクトリ
  - ログインシェル
- `chsh`コマンドでも実行できる
### 環境変数PS1
- Primary Prompt String 1 のこと
- コマンド入力するときに見えてるやつ
- `user@hostname:/current/directory$`みたいな
- 色々設定できる
| 記号   | 意味                     |
| ---- | ------------------------- |
| `\u` | ユーザー名                  |
| `\h` | ホスト名（最初の1単語）       |
| `\w` | カレントディレクトリ          |
| `\W` | カレントディレクトリの最終要素のみ    |
| `\t` | 時刻（HH\:MM\:SS）            |
| `\d` | 日付（曜日 月 日）          |
| `\$` | UIDによる記号（rootなら `#`、一般ユーザーなら `$`） |

### 環境変数 PS~ 
- `PS1`   
  - 通常のコマンド入力時に表示
  - `\u@\h:\w\$ ` → `user@host:~$`   
- `PS2` 
  - コマンドが途中で改行されたとき 
  -  `>`  → `>`              
- `PS3` 
  -  `select` コマンドのプロンプト
  -  shスクリプト内で入力待ちさせる関数
- `PS4` 
  - スクリプトのデバッグ出力の先頭文字列
    - `set -x`から`set +x`までのスクリプトをエラーとして出力する際の出力
  -  `+ ` 
  -  `+ echo hello` 

### コマンドライン操作
- カーソルの移動
  - Ctrl A
    - カーソルを行頭に移動
  - Ctrl E
    - カーソルを行末に移動
  - CTRL D
    - 一文字削除
  - CTRL H
    - カーソルの左側の1文字を削除
  - CTRL L
    - 画面をクリアして現在の行を表示
  - CTRL S
    - 画面への出力をロック
  - CTRL Q
    - 画面への出力を再開
### ディレクトリのチルダ
- `~`ホームディレクトリを指す
  - 1.一般ユーザは`/home/{username}`に飛ぶ
  - 2.ルートユーザの場合は`/root/`配下に移動
  - 3.`~ {username}`では、そのユーザのホームディレクトリに飛ぶ
- 注意ポイント
  - つまりユーザstudentでは、
    - `cd ~`は`/home/student/`へ飛ぶ
    - `cd ~student`は`/home/student/`
    - `cd ~/student`は、`/home/student/student`
### 変数
- シェル変数
  - シェルのプロセスだけで使用可能
  - 子プロセスへの継承はしない
  - `VALUE=val`などで定義
- 環境変数
  - `export`コマンドによって登録する
- １行で双方に定義することもできる
  - `export VALLUE=val`
### 変数の定義
- 文頭に数字は使えない
- スペースは引用符を入れる``
### 変数の操作
- 変数の削除
  - unset {変数名}
    - ドルマークはいらない
    - 環境変数でも、シェル変数でも削除する
- 環境変数の表示
  - env
  - printenv
  - set
### 主な環境変数
- $EDITOR
- $HISTFILE
  - コマンド履歴を格納するファイル
- $HISTFILESIZE
  - HISTFILEに保存する履歴数
- $HISTSIZE
  - コマンド履歴の最大数
- $HOME
- $HOSTNAME
- $LANG
- $LOGNAME
- $PATH
- $PS1
- $PS2
- $PWD
- $TERM
  - 端末の種類
  - xtermとかが設定されてる
- $USER

### 環境変数 PATH
- 外部コマンドを簡単に呼び出せるようにしたもの
  - type {command} で判定可能
- 外部コマンド
  - 独立したプログラムとして存在する
  - `ls`,`pi[]`
- 内部コマンド
  - `cd`,`read`,`help`などなど
  - シェルビルドインコマンドとも呼ばれる
  - シェルが異なればビルドインコマンドも異なる
### PATHの記法
- `/usr/local/bin:/bin:usr/local/games`
  - 手前に記述されているものから優先して検索する
  - ディレクトリを指定する
  - サブディレクトリは検出できない
  - 拡張子をつけずに実行するようにするのが通例
### シバンについて
- sharp(#) bang(!)のこと
- 拡張子をつけない場合、誰がファイルを実行するかを定義する
- シバンの例
  - `#!/usr/bin/env python3`
  - `#!/bin/bash`

# コマンドのノウハウ
### セミコロン`;`
- 手前のコマンドが失敗しても2番目のコマンドを実行する
### 縦線二つ`||`
- 手前のコマンドが失敗した場合に2番目のコマンドを実行
### AndAnd`&&`
- 最初のコマンドが成功した場合、2番目のコマンドを実行
### かっこ`(A;B)`
- 新たにシェルを起動して、そのシェルで実行する
### ちゅうかっこ`{A;B}`
- 現在のシェル内でコマンドを実行する

### 引用符(`)
- 囲われた範囲は全て文字列と認識する
### 二重引用符"
- 変数の指定があれば代入して文字列とする`$VALUE`
### バッククォーテーション`
- 明示的にコマンドとして定義する
  - echo \`pwd\`
  - pwdを実行
- $をつけると変数として扱い、その出力を実行しようとする
  - echo \`$path\`
  - PATHを出力。ただし、以下のエラーも出る
  - `command : path not found`

### bashにおける履歴の参照
- `history`
  - `.bash_history` を参照する
- `!{history_num}`
  - historyコマンドに付帯した履歴ナンバーを実行
- `!!`
  - 直前に実行したコマンドを再実行する
- `!{文字列}`
  - 最近に実行した{文字列}から始まるコマンドを1つ実行
- `!?{文字列}`
  - 最近に実行した{文字列}を含むコマンドを1つ実行
### manコマンド
- オンラインマニュアルページのこと
  - 内部コマンドでも外部コマンドでも双方ある
  - 他にも、設定ファイルやデバイスファイルにも書き込みがある
- オンラインだがローカルにファイルはある
- `man {コマンド}`で使用する
  - `-h`よりも詳しい情報が載っている
- `man -w {コマンド}`
  - ドキュメントファイルがどこにあるのか表示
  - `usr/share/man/`配下にドキュメントファイルを配置
  - コマンドごとにファイルが存在するわけではない
- 参照されるディレクトリはどう決まるか？
  - 1. 環境変数 `MANPATH`で指定されたディレクトリ
  - 2. `/etc/manpath.conf`で記載されたディレクトリ
- `/etc/manpath.conf`の記載内容
  - MANDATORY_MANPATH {path}
    - path に指定したmanディレクトリを検索
- `/usr/share/man/<セクション番号>/<コマンド名>.<セクション>.gz`
  - セクション番号は下記
- マニュアルファイルの実態の場所
```
/usr/share/man/
├── man1/      ← 一般ユーザーコマンド（例: ls, cp）
├── man2/      ← システムコール（例: open, read）
├── man3/      ← Cライブラリ関数（例: printf, malloc）
├── man4/      ← デバイスや特別なファイル（例: tty）
├── man5/      ← ファイル形式（例: passwd, fstab）
├── man6/      ← ゲーム
├── man7/      ← マクロ、規格、慣習など（例: man-pages）
├── man8/      ← 管理者用コマンド（例: ifconfig, mount）
└── <locale>/  ← 多言語対応（例: ja, en） 
```

- `man`コマンドでセクションの指定も可能
  - `man 1 passwd`
  - `/usr/share/man/man1/`配下にあるdocを参照
  - これはコマンドなどが同じファイル名の場合に使用する
### manファイルオプション
- `-a`
  - 全てのセクションのマニュアルを表示
- `-f` 
  - 指定された完全一致のキーワード検索
  - `whatis`コマンドでも同じことができる
  - 設定ファイルが別のセクションに保存されていることもある
- `-k`
  - 指定された部分一致のキーワード検索
  - `appropos`コマンドと同じ
- `-w`
  - マニュアルの置かれているディレクトリの表示
### ドキュメントでよく使われる見出し
- NAME
  - コマンドやファイルの名前と説明
- SYNOPSIS
  - オプションや引数の書式
- DESCRIPTION
  - 説明
- OPTIONS
- FILES
  - 関連する設定ファイル等
- ENVIRONMENT
- NOTES
- BUGS
- SEE ALSO
  - 関連項目
- AUTHOR
### ドキュメント閲覧中に使える操作(lessと同じ)
- `space`,`f`
  - 1ページスクロール
- `b`
  - 上方向に1画面スクロール
- `q`
  - 終了
- `/{key}`
  - 下方向に検索
- `?{key}`
  - 上方向に検索
- `h`
  - ヘルプを表示


### 汎用コマンド
- `whatis {word}`
  - 完全一致するmanファイルを検索する
- `appropos {word}`
  - 部分一致するmanファイルを検索する
- `ls`コマンド
  - `-a`    
    - 全て表示
  - `-A`
    - 全て表示するが、「.」「..」を表示しない
  - `-d`
    - ディレクトリ自身の情報を表示
  - `-F`
    - ファイルを表示
      - ディレクトリに「/」
      - 実行ファイルに「*」
      - シンボリックファイルに「@」
  - `-i`
    - iノード番号を付与する
      - ディレクトリやファイルに対して一意な値を付与する
  - `-l`
    - ファイルの詳細な情報を表示する
  - `-t`
    - 日付順に表示する
  - `-h`
    - 単位付きで表示する
- `cp`コマンド
  - `-f`
    - 同名のファイルがあれば上書き
  - `-i`
    - 同名のファイルがあれば確認する
  - `-p`
    - コピー元のファイルの属性も含めてコピー
    - 所有者、所属グループ
  - `-r,-R`
    - ディレクトリをコピーする
  - `-d`
    - シンボリックリンクをシンボリックリンクとしてコピーする
    - 指定しない場合は、リンクを実態のファイルとして複製する
  - `-a`
    - `-dpR`でのコピーと同じ
    - コピー元をそのままコピーしようとする
- `mv`コマンド
  - ディレクトリの移動には何もオプションがいらない
  - `-f`
    - 移動先に同名のファイルがあれば上書き
  - `-l`
    - 移動先に同名のファイルがあれば確認を入れる
- `mkdir`
  - `-m`
    - 指定したアクセス権でディレクトリを作成
    - 777などの書式も可能
  - `-p`
    - 親ディレクトリも同時に作成
- `rm`
  - `-f`
    - 確認なしで実行
  - `-i`
    - 削除する前にユーザに確認
  - `-r,-R`
    - サブディレクトリを含めて再起的に削除
- `rmdir`
  - 空のディレクトリを削除する
  - `-p`
    - 複数階層のからディレクトリを削除
- `touch`
  - 1. タイムスタンプを変更する
    - atime...access time
      - 参照した日付
    - mtime...modification time
      - 内容変更した日付
    - ctime... Change time
      - 権限などのメタデータが変更された日付
  - 2. 空のファイルを作成する
  - `-t`
    - atimeとmtimeを同時に変更する
    - 書式は[[CC]YY]MMDDhhmm[.SS]
      - CCYY...2025年などの記述
  - `-a`
    - アクセス時刻だけを変更する
  - `-m`
    - 修正時刻だけを変更する
- `file`
  - ファイルの書式を検出する
  - 文字コードや実行ファイルなどのメタデータを参照可能
### メタキャラクタ
- 「*」
  - 0文字以上の文字列が含まれる
- 「?」
  - 任意の一字が入る
- 「[]」
  - 列挙されているいづれかの一文字
  - [0-9]など
- 「{}」
  - 「.」で区切られた文字列
  - `test[0.1]`はtest1,test2になる

# 標準入力
- ファイルディスクリプタ
  - OSが識別するIOポート
  - 0...標準入力
  - 1...標準出力
  - 2...標準エラー出力
### パイプ
- `|`
  - 標準出力のコマンド
- 例:
  - `ls| wc -l`
    - wc -l ...ストリームの数を数える
  - `dmseg | less`
### teeコマンド
- パイプで渡された値を引数と次のパイプに渡す
  - `ls -l | tee ls_log | wc -l`
### リダイレクト
- `>`
  - 実行結果をファイルとして送信する
  - ファイルを上書きする
- `>>`
  - 実行結果を既存ファイルの末尾に追記する
- `<`
  - 入力を標準入力でなく、ファイルから取り入れる
  - `grep "test" < target.txt`
- `<<`
  - 特定の文字列が現れるまで入力を続ける
  - ヒアドキュメントとも
  - `cat > sample.txt << EOF`
  - cat...標準入力から取り込む
  - つまり、EOFと入力されるまで入力を受け付け、sample.txtに書き込む
- `2>`
  - エラー出力をを受け付ける
- `2>&1`
  - エラー出力(2)を評価時点の標準出力(1)に変更する
  - `command 2> file.txt 2>&1`
    - これは意味なし
    - エラーの出力先がすでに定義されているため
  - `command > file.txt 2>&1`
    - これは標準出力とエラーが同じになる
    - エラーの出力がまだ定義されていないため。
  - `commnad 2>&1 | commandB`
    - 標準出力とエラー出力をcommandBに渡す
- `&>`
  - 標準出力と標準エラーを同じファイルに書き込む
### テキスト処理
- `cat`
  - 標準出力に出す
  - `-n`各行の左端に行番号を入れる
- `nl`
  - テキストファイルに行番号をつけて表示する
  - `-b <形式>`指定した形式で本文に行番号
  - `-h <形式>`指定した形式でヘッダに行番号
  - `-f <形式>`指定した形式で振ったに行番号
  - 形式
    - `a`全ての行
    - `t`空白以外の行
    - `n`行番号の付加を中止
- `od`
  - バイナリファイルの内容を8進数,16進数で表示する
  - `-t <out-type>`
  - 出力タイプ
    - `c` ASCII
    - `o` 8進数
    - `x` 16進数
- `head`
  - ファイルの先頭部分を表示
  - デフォルトでは10行表示
  - `-n <行数>`先頭から指定された行数だけ
  - `- 行数`　先頭から行数だけ
  - `-c バイト数` 指定したバイト数だけ
- `tail`
  - ファイルの末尾を表示
  - `-n <行数>`末尾から指定された行数分を表示
  - `- 行数` 末尾から指定された行数分だけ表示
  - `-c バイト数`指定したバイト数だけ
  - `-f` 追加された行を表示し続ける
- `cut [filename]`
  - ファイルの各行から指定したフィールドを取り出す
  - `-c 文字数`取り出す位置を指定
  - `-d 区切り文字`フィールドの区切り文字を指定
  - `-f`取り出すフィールドを指定
  - `cut -c 5 file.txt`
    - 各行の5文字目を出力
  - `cut -c 1-7 file.txt`
    - 各行の1-8文字目を取り出す
- `paste`
  - 1つ以上のファイルを読みこんで、行ごとに水平方向に連結する
  - `-d <div>`区切り文字を指定
  - `paste -d";" sample.txt sample2.txt`
    - `{sampleの1行目};{sampleの2行目}`
    - という内容を出力する
- `tr [str | str]`
  - 標準入力から読み込まれた文字列を変換、削除する
  - 文字列を認識するわけではなく、対応を記述する
  - `cat text.txt | tr 'a-z' 'A-Z'`
  - 小文字を大文字に変換する
  - 文字列の検出として使える表記(class 表記)
    - [:alpha:]英字
    - [:lower:]英小文字
    - [:upper:]英大文字
    - [:digit:]数字
    - [:alnum:]英数字
    - [:space:]スペース
  - `-d`
    - 文字列を削除する
  - `-s`
    - 連続するパターンを1文字として処理
- `sort [input file] [output file]`
  - 昇順にソートする
  - `-b` 行頭の空白は無視
  - `-f` 大文字小文字の区別を無視
  - `-r` 降順ソート
  - `-n` 数字を文字ではなく、数値として処理
- `split` 行ごとに分割する。デフォルトでは1000行で分割
  - `-{num}`
    - 入力ファイルを指定された行ごとに分割
  - ファイルの末尾に「aa」「ab」「ac」...という文字が付加
- `uniq`
  - ソートされた状態で、重複しているストリームを弾く
  - `-d`重複している行のみ出力
  - `-u`重複していない行のみ出力
  - `sort file.txt | uniq`
- `wc`
  - 行数、英単語数、文字数を表示
  - `-c` 文字数（バイト）を表示
  - `-l` 行数を表示
  - `-w` 単語数を表示
- `xargs`
  - 標準入力から受け取った文字列を引数に指定する
  - `find . -mtime +60 -type f | xargs rm`
  - 更新タイムラインが60日以上のファイルを削除する
  - `xargs`を使用しない場合は以下
    - `find . -mtime +60 -type f -exec rm {} \;`
    - `-exec {command} \;`
      - これは`find`のオプション
### ファイルのチェックサムハッシュを出力するコマンド
- `md5sum {file}`
- `sha1sum {file}`
- `sha256sum {file}`
- `sha512sum {file}`
- 他のコマンドと組み合わせる際にはxargsが使用可能
  - `-c`チェックサムファイルと内容を比較する
  - `md5sum -c {filename.md5}`
### 正規表現
- `.`
  - 任意の1文字
- `[]`
  - 文字クラス
  - かっこ内に記述した文字のいづれか
  - a[au]xはaax,auxのどっちか
  - `[A-Za-z]`は英字
  - `[^abc]`はaでもbでもcでもない1文字
- `^`
  - 行頭
  - `^a` 行頭がaのもの
- `$`
  - 行末
  - `a$`aで終わるもの
- `*`
  - 繰り返し
  - `ab*z`はaz,abz,abbz...
- `\`
  - 直後をエスケープ
### grep
- テキストストリームを検索する
- `-c`
  - マッチした行数のみを表示
- `-f`
  - 検索パターンをファイルから読み込み
- `-i`
  - 大文字小文字を区別せずに検索する
- `-n`
  - 検索結果と合わせて行番号も表示する
- `-v`
  - パターンがマッチしない行を表示
- `-E`
  - 拡張正規表現を使用する
  - `egrep`を使用する場合と同じ
### 拡張正規表現
- `+` 直前の文字の1回以上の繰り返し
- `?` 直前の文字が0回もしくは1回存在
- `|` 左右いずれかの記述にマッチする
- `{n}` 直前の文字の回繰り返し
- `{n,m}`直前文字n回〜m回繰り返す
### sed
- Stream Editorの略
- テキストストリームを編集する
- `-f{file}` コマンドが書かれたスクリプトファイルを指定する
- `-i` 処理した内容でファイルを上書きする
- sedコマンド内で指定できるコマンド
  - `d`マッチした行を削除
  - `s`パターンで置換する。1行に1回だけ置換する
  - `g` sパターン使用時に1行に含まれる全ての置換を実施する
  - `y`文字を置換する
- file I/Oの場合は、行数を指定できる
  - `1,4`(1行目から4行目),`6,$`(六行目から最終行)など
  - ★記事が特殊なので注意
- `sed '1,5d' file.txt >file2.txt`
  - 1行目から5行目までを削除して出力
- `sed s/test/TEST/ file.txt`
  - 全ての行のtestをTESTに変換する処理を各行に1度行う
- `sed s/test/TEST/g file.txt`
  - 全ての行のtestをTESTに変換する 
- `sed y/ABC/123/ sample.txt`
  - Aを1に、Bを2に、Cを3に変換する
  - 検索文字と置換文字の長さは同じにする必要がある
### ファイル編集
- vim,nano,Emacsなど
- 環境変数　`EDITOR`に指定すると、デフォルトのエディタを指定
  - `crontab`などの編集の際に起動するエディタを指定できる
### vi
- モード
  - i
    - カーソルの前にテキスト入力
  - a
    - カーソルの後にテキスト入力
  - I
    - 行頭にカーソルを移動し、その直前にテキスト入力
  - A
    - 行末にカーソルを移動し、その直後にテキスト入力
  - o
    - カレント行の下に空白行を入力してテキスト入力
  - O
    - カレント行の上に空白行を挿入して、その行にテキスト入力
- 入力中でない時のカーソル操作
  - h...一文字左
  - l...一文字右に移動
  - k...１行下に指導
  - j...1行上に移動
  - 0...文頭に移動`^`でも同じ
  - $...行末に移動
  - H...画面の一番の行頭
  - L...画面の一番下の行頭
  - gg...ファイルの先頭行
  - G...ファイルの最終行
  - nG...ファイルのn行目
  - :n...ファイルのn行目
  - ※ 直前に数字を入れるとその回数繰り返す
    - `5h`で5文字左に移動
- viから離脱する
  - :q ...保存するか確認して終了
  - :q! ...保存せず終了
  - :wq ...保存して終了
  - ZZ ...保存して終了
  - :w ... 上書き保存して編集を続ける
  - :e! ...最後に保存した内容に復元
  - :r {ファイル名}...ファイルを現在の行に差し込む
  - :!{コマンド}... viを終了せずにコマンドを実行する
  - :r!{command} シェルコマンドの実行結果を挿入する
- 入力モードでない時にファイルを操作する
  - x...カーソル位置の文字を削除
  - X...カーソル位置の手前の文字を削除
  - dd...カレント行を削除
  - dw...カーソル位置からつ後の単語までを削除
  - yy...カレント行をバッファにコピー
  - p...カレント行の下にペースト
  - P...カレント行の上にペースト
  - r...カーソルの位置の1文字を置換
- vi検索コマンド
  - /{word}...カーソルから後方に向かって検索
  - ?{word}...カーソルから前方に向かって検索する
  - n...次を検索する
  - N...次を検索する（逆方向）
  - :noh...候補のハイライト表示を解除する
  - :%s/A/B/...最初に見つかった文字列を置換する
  - :%s/A/B/g...全ての文字列AをBに置換する
- viの設定変更（この変更は一度だけ）
  - :set nu...行番号を表示
  - :set nonu...行番号を非表示にする
  - :set ts={number}...タブ幅を変更する
- 設定の変更を永続化する
  - `~/homme/.vimrc`に記述
- `vimtutor`
  - vimの使いか他を教えてくれるコマンド