### モニタリングに使用するシステム達
- sar...System Activity Repoter
- sadc... System Activity Data Collector
- sadf...System Activity Dat Formatter
- iostat
- mpstat...multi prosesser statistics
- pidstat... PID statistics
- nfsiostat...network file system io statistics
- cifsiostat... common interface file systemd io statistics


#### vmstat
- メモリ，及び仮想メモリの詳細を監視する
- オプションを何もしていしなければ，その瞬間の計測量を１行で表示する
- `vmstat [表示間隔] [回数]`
- 表示項目
  - proc
    - r...実行待ちプロセス数(runnable)
    - b...割り込み不可能なスリープ状態のプロセス数(blocked)，uninterrupt sleepともいう
  - memory
    - swpd...スワップサイズ
    - free...空きメモリサイズ
    - buff...バッファに割り当てられているメモリ(KB)
    - cache...キャッシュに割り当てられているメモリサイズ(KB)
  - swap
    - si...ディスクからスワップインされているメモリサイズ(KB/s)
    - so...ディスクへスワップアウトされているメモリサイズ(KB/s)
  - io
    - bi...ブロックデバイスから受け取った前ブロック数．（ブロック数/s）
    - bo...ブロックデバイスに送られたブロック数．（ブロック数/s）
  - system
    - in...1s当たりの割り込み回数．クロック割り込みも含む
    - cs...1s当たりのコンテキストスイッチの回数
  - cpu
    - us...ユーザプロセスがCPUを利用している時間の割合(user)
    - sy...カーネルがCPUを使用している時間の割合(system)
    - id...CPUがアイドル状態の時間の割合(idole)
    - wa...ディスクがI/O待ちの時間の割合(wait)
    - st...ゲストOSがCPUを割り当てられなかった時間の割合(steal)

#### モジュール関連
- lsmod
- modinfo
- insmod、modprobe
- rmmod、modprobe -r
- depmod
  - modules.dep
- modprobe.conf
  - alias
  - options
  - install
  - remove
  - blacklist
- `/lib/modules/$(uname -r)/kernel/drivers/{any}.ko`
### Linuxがカーネルがある場所
- kenel.org
- usr/src/linux
  - ここから.config,makeを実施
- bzImage,zImageを作成
- vmlinuz(Virtual Memory Linuz Zipeed)
  - /boot/vmlinuz-*/

#### tarのさらなるオmプション
- bzipやgzip、xzと違って元のファイルは残す
- また、指定したファイルだけを取り出すこともできる
- `tar -xvf sample.tar /{path} [option]`
  - ディレクトリ、ファイルだけ取り出すのも可能
- オプション
  - --wildcards "{expand_word}"...特定の形式のファイルを取り出す

#### ssdにおいて、データを削除する
- TRIM機能
- 実行は`fstrim -v`
  - fstabに沿ってtrimしたりもできる
    - オプションにdiscardがついていれば、マウント時にfstrim
#### mdadm主要なオプション
- RAID構成するアレ
- 作成
  - `mdadm -Ca -l=1 -n=2 /dev/sda1 /dev/sdb1`
- 操作
  - `mdadm --manage --add /dev/md0 /dev/sdd1 `
    - デフォルトではホットスペアとして追加される
  - `mdadm --manage --remove /dev/md0 /dev/sda1`
  - `mdadm --fall /dev/md0 /dev/sda1`
- その他
  - `mdadm -Q`...状態確認
  - `mdadm -D`...詳細な状態を確認
  - `mdadm -E`...構成デバイスの状態を確認
- ドライ実行できないので注意


#### 覚えておくべきRAID
- 0...2台以上のストライピング構成。異なるストレージとして使用
- 1...2台以上同期構成。同じストレージとして使用
- 4...3台以上のストライピング・パリティ構成。専用ディスク
- 5...3台以上のストライピング・パリティ構成。分散思考
- 6...4台以上のストライピング・パリティ構成。2台故障補償。分散
- 10...4台以上でストライプと同期構成を取る

### 論理ストレージから削除する
- vgreduce,vgremove
- lvreduce,lvremove
- reduceを使用すると、部分的に除外する
  - vgreduce {pv}..vgからpvを外す
  - vgremove {vg}...vgをまるっと削除する
- lvの場合
  - lvreduce -L {vol} {lv}...容量を減らす
  - lvremove {lv} ...lvが完全に消える

### /proc/mdstatを読む
- コンピュータ上に構成されるマルチデバイス構成を検出
```
$ cat /proc/mdstat
Personalities : [raid1] [raid5]
md0 : active raid5 sdc1[3] sdd1[2] sdb1[1]
      1953383488 blocks super 1.2 level 5, 512k chunk, algorithm 2
      [3/3] [UUU]

md1 : active raid1 sde1[0] sdf1[1]
      9766304 blocks super 1.2 [2/2] [UU]

unused devices: <none>
```
- わかること
  - mddevファイルがどんな構成で実行されているのか
  - 構成ディスクとそのRAID内部管理番号(sdc[3])
  - 構成ディスクの扱い
    - (S)...Spare
      - スタンバイ構成
    - (F)...Faulty
    - (W)...Write-mostly
    - (R)...Repalcement
      - 同期中
    - (J)...Journal
  - [N/M]...N台を想定して、M台起動している
    - ここが1を超えていると故障であることがわかる
    - ここにスペアは表示しない
  - [UUU]...故障があると表記が変わる
    - [U_U]だと中央が故障している
#### fstabを復習
- `/etc/fstab`
  - 1. デバイスファイル/ラベル/UUID
  - 2. マウントポイント
  - 3. ファイルシステムの種類
  - 4. マウントオプション
  - 5. dumpの対象か？
  - 6. ブート時にfsckするかどうか？
- マウントオプション
  - default
    - rw
    - suid
    - dev
    - exec
    - auto
    - nouser
    - async
- ちょっと古いデバイス特有のオプション
  - uid,gid...この名前/グループを所有者とする
  - umask...アクセス権に関するumaskを定義
  - fmask...ファイルの権限だけをumask形式で定義
  - dmask...ディレクトリの権限だけをumask形式で定義
  - shortname...FATファイル名の扱いを指定
  - iocharset...文字コードを指定
### デバイスの命名規則
- IDE接続
  - 40/80ピン
  - これはストレージのみ接続される
  - /dev/hda
  - /dev/hdb
  - /dev/hdc
  - /dev/hdd
  - 上記4台のみ定義される
- SATA
  - まず、何が接続されたかか確認する
    - ストレージの場合
      - /dev/sda
      - /dev/sdb
    - 光学ディスクの場合
      - /dev/sr0
      - /dev/sr1
      - ※ 1からナンバリングしていく
- Linux Kernel 2.6以降は、全てのデバイスに対して/dev/sd*という命名になった